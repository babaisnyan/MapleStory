<?xml version="1.0" encoding="utf-8"?>

<GameDB>
  <Table name="Account" desc="계정 테이블">
    <Column name="id" type="int" notnull="true" identity="1,1" />
    <Column name="username" type="nvarchar(50)" notnull="true" />
    <Column name="password" type="nvarchar(50)" notnull="true" />
    <Column name="createDate" type="datetime" notnull="true" />
    <Column name="status" type="int" notnull="true" />
    <Index type="clustered">
      <PrimaryKey />
      <Column name="id" />
    </Index>
  </Table>

  <Procedure name="spLogin">
    <Param name="@username" type="nvarchar(50)" />
    <Param name="@password" type="nvarchar(50)" />
    <Body>
      <![CDATA[
      DECLARE @accountid int
      SELECT @accountid = id FROM [dbo].[Account] WHERE username = @username
      IF @accountid IS NULL
      BEGIN
        SELECT 1 AS result, 0 AS id
      END
      ELSE
      BEGIN
        DECLARE @status int
        SELECT @status = status FROM [dbo].[Account] WHERE id = @accountid
        IF @status > 0
        BEGIN
          SELECT 3 AS result, 0 AS id
        END
        ELSE
        BEGIN
          DECLARE @passwordHash nvarchar(50)
          SELECT @passwordHash = password FROM [dbo].[Account] WHERE id = @accountid
          IF @passwordHash = @password
          BEGIN
            SELECT 0 AS result, @accountid AS id
          END
          ELSE
          BEGIN
            SELECT 2 AS result, 0 AS id
          END
        END
      END
      ]]>
    </Body>
  </Procedure>

</GameDB>