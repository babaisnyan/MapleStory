{%- macro lower_first(text) %}{{text[0]|lower}}{{text[1:]}}{% endmacro -%}

{%- for proc in procs %}
class {{proc.name}} : public DbBind<{{proc.params|length}},{{proc.columns|length}}>
{
public:
	explicit {{proc.name}}(DbConnection& conn) : DbBind(conn, L"{CALL dbo.sp{{ proc.name }}{{ proc.questions }}}") { }

{%- for param in proc.params %}
  {%- if param.type == 'nvarchar' %}
	template<int32_t N> void In{{param.name}}(wchar_t(&v)[N]) { BindParam({{loop.index - 1}}, v); }
	template<int32_t N> void In{{param.name}}(const wchar_t(&v)[N]) { BindParam({{loop.index - 1}}, v); }
	void In{{param.name}}(wchar_t* v, const int32_t count) { BindParam({{loop.index - 1}}, v, count); }
	void In{{param.name}}(const wchar_t* v, const int32_t count) { BindParam({{loop.index - 1}}, v, count); }
  {%- elif param.type == 'varbinary' %}
	template<typename T, int32_t N> void In{{param.name}}(T(&v)[N]) { BindParam({{loop.index - 1}}, v); }
	template<typename T> void In{{param.name}}(T* v, int32_t count) { BindParam({{loop.index - 1}}, v, count); }
  {%- else %}
	void In{{param.name}}({{param.type}}& v) { BindParam({{loop.index - 1}}, v); }
	void In{{param.name}}({{param.type}}&& v) { _{{lower_first(param.name)}} = std::move(v); BindParam({{loop.index - 1}}, _{{lower_first(param.name)}}); }
  {%- endif %}
{%- endfor %}

{%- for column in proc.columns %}
  {%- if column.type == 'nvarchar' %}
	template<int32_t N> void Out{{column.name}}(wchar_t(&v)[N]) { BindCol({{loop.index - 1}}, v); }
  {%- elif column.type == 'varbinary' %}
	template<typename T, int32_t N> void Out{{column.name}}(T(&v)[N]) { BindCol({{loop.index - 1}}, v); }
  {%- else %}
	void Out{{column.name}}({{column.type}}& v) { BindCol({{loop.index - 1}}, v); }
  {%- endif %}
{%- endfor %}

private:
{%- for param in proc.params %}
  {%- if param.type == 'int32_t' or param.type == 'TIMESTAMP_STRUCT' %}
	{{param.type}} _{{lower_first(param.name)}} = {};
  {%- endif %}
{%- endfor %}
};
{% endfor %}


